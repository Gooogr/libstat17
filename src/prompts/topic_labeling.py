# flake8: noqa

TOPIC_LABELING_PROMPT = """
ТЫ — эксперт по разметке тем дискуссий в VK-группах библиотек.

ЗАДАЧА:
По каждой теме разметь topic_type и confidence, используя:
- заголовок темы (topic_title)
- ПЕРВОЕ сообщение в теме (first_message) — если оно есть

1) topic_type:
   - "book_wish" — потребность/хотелки в книгах и печатных изданиях
     (в т.ч. "ветхая книга ищет близнеца", "ветхие книги...", "примем в дар книги",
      "книжные хотелки", "школьный список", "школьная программа",
      "подписка", "периодика", "газеты", "журналы", "периодические издания")
   - "nonbook_wish" — потребность/хотелки НЕ в книгах
     (в т.ч. "некнижные хотелки/мечты/желания", "не книжные хотелки",
      "разное", "разные нужности", "канцтовары", "техника", "игры", "настольные игры",
      "ламинатор", "принтер", "бумага", "мебель", "стеллажи" и т.п.)
   - "thank" — благодарности / полученные подарки / закрытые запросы
     (в т.ч. “спасибо”, “благодарим”, “благодарность”, “нам подарили”,
      “подаренные нам…”, “наши подарки”, “получили”, “отчёт о подарках”,
      а также “книга нашла близнеца”, “заменили на новую”, “заменена”)
   - "other" — всё остальное.

2) confidence — число (float), строго 0..1. (насколько уверен в topic_type)

КЛЮЧЕВЫЕ ПРАВИЛА:
- Используй ТОЛЬКО поля topic_title и first_message. Никаких других данных/контекста.
- В первую очередь ориентируйся на topic_title. first_message используй:
  - чтобы уточнить тип, когда заголовок общий/непонятный ("в дар", "нуждаемся", "помогите", "хотелки")
  - чтобы отличить book_wish от nonbook_wish, если заголовок не уточняет предмет.
- Если заголовок содержит "примем/примет в дар" или "в дар", но не уточняет предмет:
  по умолчанию ставь "book_wish" с confidence 0.55–0.75,
  НО если в first_message явно перечислены НЕ книги (канц/техника/игры/мебель и т.п.) — ставь "nonbook_wish".
- Если в first_message явно перечислены книги/авторы/серии/«список книг»/«нуждается в замене книг» — это "book_wish".
- Если first_message в основном про благодарность/получили/прислали/заменили/отчитались — это "thank".
- Если сомневаешься — ставь topic_type="other" и понижай confidence.
- Выводи ТОЛЬКО JSON, без пояснений.

ВХОД:
[
  {
    "place_id": 1,
    "topics": [
      {"topic_id": 123, "topic_title": "примем в дар", "first_message": "Примем в дар книги для детей..."},
      ...
    ]
  },
  ...
]

ВЫХОД:
{
  "rows": [
    {"place_id": 1, "topic_id": 123, "topic_type": "book_wish", "confidence": 0.85}
  ]
}
""".strip()
