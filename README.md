# libstat17

Пайплайн для сбора и структурирования запросов библиотек из группы «Страница №17».

## Быстрый старт

### Установка зависимостей
```bash
poetry install
```

### Заполнение `.env` файла
Скопировать шаблон `.env.example`

Скопировать сервисный вк токен по сгенерированной ссылке
```bash
python scripts/create_vk_token.py
```

Добавить API-ключ для LLM провайдера
Подробности: https://docs.litellm.ai/docs/set_keys#environment-variables

### Запуск пайплайна данных

```bash
snakemake --cores 1
```

Где какие данные храним:

`data/external` - сырые данные из API вк и парсера яндекс карт
`data/interim` - плоские CSV таблицы на основе сырых данных
`data/proceced` - Данные извлеченные с помощью LLM
`data/datalens` - Данные готовые к визуализации в DataLens

## LLM шаги
Эти шаги также входят в Snakemake-пайплайн, но при необходимости их можно запускать вручную.

### Разметка тем в обсуждениях групп

```bash
python ./scripts/label_topics.py --out-csv ./data/processed/topic_labels.csv
```

Возможные значения меток:
- `book_wishes`
- `nonbook_wishes`
- `thank`
- `other`

### Извлечение пожеланий библиотек
```bash
python ./scripts/extract_books_wishes.py --out-csv ./data/processed/wishes_books.csv
python ./scripts/extract_nonbook_wishes.py --out-csv ./data/processed/wishes_nonbook.csv
```
Категории хотелок библиотек

| category             | when to use (rules)                                                                                                                                                                                                               | typical items (examples)                                                                                                                                                                                                                                                   |
| -------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `furniture`          | Запросы про мебель или организацию хранения                                                            | стеллаж, полка/книжная полка, шкаф, тумба, стол/парта, стул/кресло, кресло-мешок/пуф, стойка/витрина для журналов, комод, вешалка напольная, коробки/контейнеры для хранения, органайзеры                                                               |
| `tech_equipment`     | Электроника, без учета расходников к ней                                                                      | компьютер/ноутбук/планшет, принтер/МФУ, проектор, экран, колонки/акустика, микрофон, фотоаппарат, веб-камера, сканер, ламинатор, беспроводной пылесос                                          |
| `supplies`           | Расходники, канцелярия, мелкие офисные предметы, материалы для творчества, картирджи для принтера | бумага A4/цветная/картон, тетради/блокноты, папки/файлы, ручки/карандаши/фломастеры, клей/скотч, ножницы, степлер/скобы, дырокол, пленка для ламинирования, краски/кисти, пластилин, фоамиран/фетр/синельная проволока, маркеры для доски, картриджи/тонер, фотобумага |
| `nonbook_activities` | Предметы для проведения разных занятий и активностей | пазлы, настольные игры, лото/домино/шашки/шахматы, развивающие наборы, глобус, мольберт, демонстрационные материалы для занятий, наборы для опытов/творчества, спортивный инвентарь для игр                          |
| `facility_care`      | Уборка и мелкий ремонт                                                                    | швабра/ведро, хозяйственные принадлежности, моющие средства, стремянка, инструменты для мелкого ремонта, мусорные пакеты, шторы/жалюзи, коврики         |
| `event_decor`        | Предметы и укаршения к праздникам и мероприятиям                                                                              | воздушные шары, стойка/арка для шаров, гирлянды, баннеры/растяжки, фотозона/фон, тематические украшения, конфетти, реквизит для праздника, костюмы для выступлений                                                                    |
| `other`              | Все что не попало в категории выше                                                                                                                | “нужно разное для библиотеки”, “помощь чем сможете”, редкие специфические предметы без контекста, противоречивые запросы                                                                                                                                                   |

